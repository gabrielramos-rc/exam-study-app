# Task 1.6: Basic Layout

## Context

This is the final task in Phase 1 (Project Foundation) of the Exam Study App. The project already has Next.js 16 set up with TypeScript, Tailwind CSS 4, shadcn/ui components, Prisma ORM with PostgreSQL, and Kubernetes deployment configured. This task creates the application shell - the root layout with providers, sidebar navigation, and header with theme toggle. This layout will wrap all pages and provide the consistent navigation structure for the entire application.

## Objective

Create the basic application layout including a root layout with providers, sidebar navigation component, header component with theme toggle, and dark/light mode support using next-themes.

## Git Workflow

Before starting, set up your branch:

```bash
# Ensure you're on dev and up to date
git checkout dev
git pull origin dev

# Create task-specific branch
git checkout -b feature/1.6-basic-layout
```

## Instructions

### Step 1: Install next-themes

Install the next-themes package for dark/light mode support:

```bash
npm install next-themes
```

### Step 2: Create Theme Provider

Create a theme provider component that wraps next-themes:

**File: `src/components/providers/theme-provider.tsx`**

```tsx
"use client";

import * as React from "react";
import { ThemeProvider as NextThemesProvider } from "next-themes";

export function ThemeProvider({
  children,
  ...props
}: React.ComponentProps<typeof NextThemesProvider>) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}
```

### Step 3: Create App Providers Component

Create a providers wrapper component that will contain all app providers:

**File: `src/components/providers/index.tsx`**

```tsx
"use client";

import { ThemeProvider } from "./theme-provider";

interface ProvidersProps {
  children: React.ReactNode;
}

export function Providers({ children }: ProvidersProps) {
  return (
    <ThemeProvider
      attribute="class"
      defaultTheme="dark"
      enableSystem
      disableTransitionOnChange
    >
      {children}
    </ThemeProvider>
  );
}
```

### Step 4: Create Theme Toggle Component

Create a theme toggle button for the header:

**File: `src/components/layout/theme-toggle.tsx`**

```tsx
"use client";

import * as React from "react";
import { Moon, Sun } from "lucide-react";
import { useTheme } from "next-themes";
import { Button } from "@/components/ui/button";

export function ThemeToggle() {
  const { theme, setTheme } = useTheme();
  const [mounted, setMounted] = React.useState(false);

  // Avoid hydration mismatch
  React.useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) {
    return (
      <Button variant="ghost" size="icon" disabled>
        <Sun className="h-5 w-5" />
        <span className="sr-only">Toggle theme</span>
      </Button>
    );
  }

  return (
    <Button
      variant="ghost"
      size="icon"
      onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
    >
      {theme === "dark" ? (
        <Sun className="h-5 w-5" />
      ) : (
        <Moon className="h-5 w-5" />
      )}
      <span className="sr-only">Toggle theme</span>
    </Button>
  );
}
```

### Step 5: Create Header Component

Create the header component with app title and theme toggle:

**File: `src/components/layout/header.tsx`**

```tsx
import { GraduationCap } from "lucide-react";
import { ThemeToggle } from "./theme-toggle";

export function Header() {
  return (
    <header className="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="flex h-14 items-center px-4 md:px-6">
        <div className="flex items-center gap-2 font-semibold">
          <GraduationCap className="h-6 w-6 text-primary" />
          <span className="hidden sm:inline-block">Exam Study</span>
        </div>
        <div className="ml-auto flex items-center gap-2">
          <ThemeToggle />
        </div>
      </div>
    </header>
  );
}
```

### Step 6: Create Sidebar Navigation Component

Create the sidebar navigation with links to main sections:

**File: `src/components/layout/sidebar.tsx`**

```tsx
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  LayoutDashboard,
  BookOpen,
  Settings,
  FolderCog,
} from "lucide-react";
import { cn } from "@/lib/utils";

const navItems = [
  {
    title: "Dashboard",
    href: "/",
    icon: LayoutDashboard,
  },
  {
    title: "Exams",
    href: "/admin/exams",
    icon: BookOpen,
  },
  {
    title: "Admin",
    href: "/admin",
    icon: FolderCog,
  },
  {
    title: "Settings",
    href: "/settings",
    icon: Settings,
  },
];

export function Sidebar() {
  const pathname = usePathname();

  return (
    <aside className="hidden md:flex md:w-64 md:flex-col md:fixed md:inset-y-0 md:pt-14 border-r border-border bg-background">
      <nav className="flex-1 space-y-1 px-3 py-4">
        {navItems.map((item) => {
          const isActive =
            pathname === item.href ||
            (item.href !== "/" && pathname.startsWith(item.href));
          return (
            <Link
              key={item.href}
              href={item.href}
              className={cn(
                "flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition-colors",
                isActive
                  ? "bg-secondary text-secondary-foreground"
                  : "text-muted-foreground hover:bg-secondary/50 hover:text-foreground"
              )}
            >
              <item.icon className="h-5 w-5" />
              {item.title}
            </Link>
          );
        })}
      </nav>
    </aside>
  );
}
```

### Step 7: Create Mobile Navigation Component

Create a mobile-friendly bottom navigation for smaller screens:

**File: `src/components/layout/mobile-nav.tsx`**

```tsx
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  LayoutDashboard,
  BookOpen,
  Settings,
  FolderCog,
} from "lucide-react";
import { cn } from "@/lib/utils";

const navItems = [
  {
    title: "Home",
    href: "/",
    icon: LayoutDashboard,
  },
  {
    title: "Exams",
    href: "/admin/exams",
    icon: BookOpen,
  },
  {
    title: "Admin",
    href: "/admin",
    icon: FolderCog,
  },
  {
    title: "Settings",
    href: "/settings",
    icon: Settings,
  },
];

export function MobileNav() {
  const pathname = usePathname();

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-50 md:hidden border-t border-border bg-background">
      <div className="flex items-center justify-around h-16">
        {navItems.map((item) => {
          const isActive =
            pathname === item.href ||
            (item.href !== "/" && pathname.startsWith(item.href));
          return (
            <Link
              key={item.href}
              href={item.href}
              className={cn(
                "flex flex-col items-center justify-center gap-1 px-3 py-2 text-xs font-medium transition-colors min-w-[64px]",
                isActive
                  ? "text-primary"
                  : "text-muted-foreground hover:text-foreground"
              )}
            >
              <item.icon className="h-5 w-5" />
              <span>{item.title}</span>
            </Link>
          );
        })}
      </div>
    </nav>
  );
}
```

### Step 8: Create Main Layout Component

Create a main layout component that combines header, sidebar, and mobile nav:

**File: `src/components/layout/main-layout.tsx`**

```tsx
import { Header } from "./header";
import { Sidebar } from "./sidebar";
import { MobileNav } from "./mobile-nav";

interface MainLayoutProps {
  children: React.ReactNode;
}

export function MainLayout({ children }: MainLayoutProps) {
  return (
    <div className="min-h-screen bg-background">
      <Header />
      <Sidebar />
      <main className="md:pl-64">
        <div className="container mx-auto px-4 py-6 pb-20 md:pb-6">
          {children}
        </div>
      </main>
      <MobileNav />
    </div>
  );
}
```

### Step 9: Create Layout Component Barrel Export

Create an index file to export all layout components:

**File: `src/components/layout/index.ts`**

```tsx
export { Header } from "./header";
export { Sidebar } from "./sidebar";
export { MobileNav } from "./mobile-nav";
export { MainLayout } from "./main-layout";
export { ThemeToggle } from "./theme-toggle";
```

### Step 10: Update Root Layout

Update the root layout to include providers and set up proper metadata:

**File: `src/app/layout.tsx`**

```tsx
import type { Metadata, Viewport } from "next";
import { Inter } from "next/font/google";
import { Providers } from "@/components/providers";
import "./globals.css";

const inter = Inter({
  subsets: ["latin"],
  variable: "--font-sans",
});

export const metadata: Metadata = {
  title: {
    default: "Exam Study App",
    template: "%s | Exam Study",
  },
  description: "Self-hosted exam study app with spaced repetition",
  keywords: ["exam", "study", "flashcards", "spaced repetition", "certification"],
  authors: [{ name: "Exam Study App" }],
};

export const viewport: Viewport = {
  themeColor: [
    { media: "(prefers-color-scheme: light)", color: "white" },
    { media: "(prefers-color-scheme: dark)", color: "#020617" },
  ],
  width: "device-width",
  initialScale: 1,
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={`${inter.variable} font-sans antialiased`}>
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
```

### Step 11: Update Home Page

Update the home page to use the new layout and show a dashboard placeholder:

**File: `src/app/page.tsx`**

```tsx
import { MainLayout } from "@/components/layout";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { BookOpen, Brain, TrendingUp, Plus } from "lucide-react";
import Link from "next/link";

export default function HomePage() {
  return (
    <MainLayout>
      <div className="space-y-6">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">Dashboard</h1>
          <p className="text-muted-foreground">
            Welcome to Exam Study App. Start studying for your certifications.
          </p>
        </div>

        {/* Quick Stats */}
        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Total Exams</CardTitle>
              <BookOpen className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">0</div>
              <p className="text-xs text-muted-foreground">
                No exams created yet
              </p>
            </CardContent>
          </Card>
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Questions</CardTitle>
              <Brain className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">0</div>
              <p className="text-xs text-muted-foreground">
                Import questions to start
              </p>
            </CardContent>
          </Card>
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Due for Review</CardTitle>
              <TrendingUp className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">0</div>
              <p className="text-xs text-muted-foreground">
                Cards due today
              </p>
            </CardContent>
          </Card>
          <Card>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">Accuracy</CardTitle>
              <TrendingUp className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">--%</div>
              <p className="text-xs text-muted-foreground">
                Start studying to track
              </p>
            </CardContent>
          </Card>
        </div>

        {/* Empty State / Getting Started */}
        <Card>
          <CardHeader>
            <CardTitle>Get Started</CardTitle>
            <CardDescription>
              Create your first exam and import questions to begin studying.
            </CardDescription>
          </CardHeader>
          <CardContent className="flex flex-col gap-4 sm:flex-row">
            <Button asChild>
              <Link href="/admin/exams/new">
                <Plus className="mr-2 h-4 w-4" />
                Create Exam
              </Link>
            </Button>
            <Button variant="outline" asChild>
              <Link href="/admin/exams">
                <BookOpen className="mr-2 h-4 w-4" />
                View Exams
              </Link>
            </Button>
          </CardContent>
        </Card>
      </div>
    </MainLayout>
  );
}
```

### Step 12: Create Placeholder Pages

Create placeholder pages for the navigation links. These will be fully implemented in later phases.

**File: `src/app/admin/page.tsx`**

```tsx
import { MainLayout } from "@/components/layout";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { FolderCog, Upload, Download } from "lucide-react";
import Link from "next/link";

export default function AdminPage() {
  return (
    <MainLayout>
      <div className="space-y-6">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">Admin</h1>
          <p className="text-muted-foreground">
            Manage your exams and study progress.
          </p>
        </div>

        <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <FolderCog className="h-5 w-5" />
                Exam Management
              </CardTitle>
              <CardDescription>
                Create, edit, and delete exams. Import questions from ZIP files.
              </CardDescription>
            </CardHeader>
            <CardContent>
              <Button asChild className="w-full">
                <Link href="/admin/exams">Manage Exams</Link>
              </Button>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Download className="h-5 w-5" />
                Export Progress
              </CardTitle>
              <CardDescription>
                Export your study progress for backup or transfer.
              </CardDescription>
            </CardHeader>
            <CardContent>
              <Button variant="outline" className="w-full" disabled>
                Export (Coming Soon)
              </Button>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Upload className="h-5 w-5" />
                Import Progress
              </CardTitle>
              <CardDescription>
                Restore study progress from a previous export.
              </CardDescription>
            </CardHeader>
            <CardContent>
              <Button variant="outline" className="w-full" disabled>
                Import (Coming Soon)
              </Button>
            </CardContent>
          </Card>
        </div>
      </div>
    </MainLayout>
  );
}
```

**File: `src/app/admin/exams/page.tsx`**

```tsx
import { MainLayout } from "@/components/layout";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Plus, BookOpen } from "lucide-react";
import Link from "next/link";

export default function ExamsPage() {
  return (
    <MainLayout>
      <div className="space-y-6">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold tracking-tight">Exams</h1>
            <p className="text-muted-foreground">
              Manage your certification exams.
            </p>
          </div>
          <Button asChild>
            <Link href="/admin/exams/new">
              <Plus className="mr-2 h-4 w-4" />
              New Exam
            </Link>
          </Button>
        </div>

        {/* Empty State */}
        <Card>
          <CardContent className="flex flex-col items-center justify-center py-12">
            <BookOpen className="h-12 w-12 text-muted-foreground mb-4" />
            <CardTitle className="mb-2">No exams yet</CardTitle>
            <CardDescription className="text-center mb-4">
              Create your first exam to start importing questions.
            </CardDescription>
            <Button asChild>
              <Link href="/admin/exams/new">
                <Plus className="mr-2 h-4 w-4" />
                Create Exam
              </Link>
            </Button>
          </CardContent>
        </Card>
      </div>
    </MainLayout>
  );
}
```

**File: `src/app/admin/exams/new/page.tsx`**

```tsx
import { MainLayout } from "@/components/layout";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { ArrowLeft } from "lucide-react";
import Link from "next/link";

export default function NewExamPage() {
  return (
    <MainLayout>
      <div className="space-y-6">
        <div className="flex items-center gap-4">
          <Button variant="ghost" size="icon" asChild>
            <Link href="/admin/exams">
              <ArrowLeft className="h-4 w-4" />
            </Link>
          </Button>
          <div>
            <h1 className="text-3xl font-bold tracking-tight">New Exam</h1>
            <p className="text-muted-foreground">
              Create a new certification exam.
            </p>
          </div>
        </div>

        <Card className="max-w-2xl">
          <CardHeader>
            <CardTitle>Exam Details</CardTitle>
            <CardDescription>
              Enter the details for your new exam.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form className="space-y-4">
              <div className="space-y-2">
                <label htmlFor="name" className="text-sm font-medium">
                  Exam Name
                </label>
                <Input
                  id="name"
                  placeholder="e.g., AWS Solutions Architect"
                  disabled
                />
              </div>
              <div className="space-y-2">
                <label htmlFor="description" className="text-sm font-medium">
                  Description
                </label>
                <Input
                  id="description"
                  placeholder="e.g., AWS SAA-C03 certification exam"
                  disabled
                />
              </div>
              <div className="flex gap-4">
                <Button type="submit" disabled>
                  Create Exam
                </Button>
                <Button variant="outline" asChild>
                  <Link href="/admin/exams">Cancel</Link>
                </Button>
              </div>
              <p className="text-sm text-muted-foreground">
                Form functionality will be implemented in Phase 2.
              </p>
            </form>
          </CardContent>
        </Card>
      </div>
    </MainLayout>
  );
}
```

**File: `src/app/settings/page.tsx`**

```tsx
import { MainLayout } from "@/components/layout";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { ThemeToggle } from "@/components/layout";

export default function SettingsPage() {
  return (
    <MainLayout>
      <div className="space-y-6">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">Settings</h1>
          <p className="text-muted-foreground">
            Customize your study experience.
          </p>
        </div>

        <div className="grid gap-4 max-w-2xl">
          <Card>
            <CardHeader>
              <CardTitle>Appearance</CardTitle>
              <CardDescription>
                Customize how the app looks on your device.
              </CardDescription>
            </CardHeader>
            <CardContent className="flex items-center justify-between">
              <div>
                <p className="font-medium">Theme</p>
                <p className="text-sm text-muted-foreground">
                  Toggle between light and dark mode.
                </p>
              </div>
              <ThemeToggle />
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Study Preferences</CardTitle>
              <CardDescription>
                Configure your study session settings.
              </CardDescription>
            </CardHeader>
            <CardContent>
              <p className="text-sm text-muted-foreground">
                Additional settings will be available in Phase 6.
              </p>
            </CardContent>
          </Card>
        </div>
      </div>
    </MainLayout>
  );
}
```

### Step 13: Verify Setup

Run the development server to verify the layout works correctly:

```bash
npm run dev
```

Then verify:
1. Open http://localhost:3000 in your browser
2. Check that the sidebar navigation appears on desktop (md breakpoint and up)
3. Check that the bottom navigation appears on mobile (below md breakpoint)
4. Click the theme toggle and verify dark/light mode switching works
5. Navigate to each page using the sidebar/bottom nav links
6. Verify the page titles and content display correctly

### Step 14: Run Linting and Type Check

Ensure there are no linting or type errors:

```bash
npm run lint
npm run typecheck
```

## Documentation Updates

After completing the implementation, update the project documentation:

### Update `.claude/docs/07-implementation-tasks.md`

Mark completed items with `[x]`:

```markdown
### 1.6 Basic Layout

**Read:** `05-frontend-design.md` (Page Layouts section)
- [x] Create root layout with providers
- [x] Create sidebar navigation component
- [x] Create header component with theme toggle
- [x] Set up next-themes for dark/light mode
```

### Update `.claude/docs/02-technical-architecture.md`

Verify the Project Structure section reflects the new files:
- `src/components/layout/` - Layout components
- `src/components/providers/` - Provider components

### Update `.claude/docs/00-quick-reference.md`

Add any new quick-access information:

```markdown
## Layout Components

- `MainLayout` - Main app layout with header, sidebar, mobile nav
- `ThemeToggle` - Dark/light mode toggle button
- `Providers` - App-wide providers wrapper
```

## Acceptance Criteria

Before marking this task complete, verify:

1. `npm install next-themes` completes successfully
2. Theme provider is set up and dark mode is the default
3. Theme toggle button switches between dark and light modes
4. Sidebar navigation appears on desktop (md breakpoint and up)
5. Bottom navigation appears on mobile (below md breakpoint)
6. All navigation links work and show correct active states
7. Header displays app logo/title and theme toggle
8. Home page shows dashboard with placeholder stats
9. All placeholder pages render correctly
10. `npm run lint` passes with no errors
11. `npm run typecheck` passes with no errors
12. Documentation in `.claude/docs/` is updated to reflect changes
13. Task items in `07-implementation-tasks.md` are marked as complete `[x]`

## Git Completion

After all acceptance criteria pass:

```bash
# Stage all changes (including doc updates)
git add .

# Commit with conventional commit message
git commit -m "$(cat <<'EOF'
feat(ui): add basic layout with sidebar and theme toggle

- Add next-themes for dark/light mode support
- Create theme provider and toggle component
- Create header component with app branding
- Create sidebar navigation for desktop
- Create bottom navigation for mobile
- Create main layout wrapper component
- Update root layout with providers
- Add placeholder pages for navigation
- Update home page with dashboard layout

Task: 1.6
EOF
)"

# Push branch to remote
git push -u origin feature/1.6-basic-layout

# Create PR to dev branch
gh pr create --base dev --title "feat(ui): Basic Layout with Navigation and Theme" --body "$(cat <<'EOF'
## Summary
- Added next-themes for dark/light mode support
- Created responsive navigation (sidebar for desktop, bottom nav for mobile)
- Created header with theme toggle
- Set up placeholder pages for navigation structure

## Task Reference
Task 1.6 from implementation roadmap (Phase 1: Project Foundation)

## Changes
- `src/components/providers/` - Theme provider and app providers
- `src/components/layout/` - Header, Sidebar, MobileNav, MainLayout, ThemeToggle
- `src/app/layout.tsx` - Updated root layout with providers
- `src/app/page.tsx` - Dashboard home page
- `src/app/admin/` - Admin and exam management placeholder pages
- `src/app/settings/` - Settings page with theme toggle

## Documentation Updated
- [ ] `07-implementation-tasks.md` - marked tasks complete
- [ ] `02-technical-architecture.md` - verified project structure
- [ ] `00-quick-reference.md` - added layout component info

## Testing
- [ ] Theme toggle works (dark/light modes)
- [ ] Sidebar navigation visible on desktop
- [ ] Bottom navigation visible on mobile
- [ ] All navigation links work correctly
- [ ] Active states show on current page
- [ ] Lint and typecheck pass
EOF
)"
```

## Notes

- **Out of Scope**: Do NOT implement functional exam CRUD operations - those are in Task 2.1
- **Out of Scope**: Do NOT implement actual data fetching for dashboard stats - those will use real APIs in later phases
- **Out of Scope**: Do NOT implement PWA manifest or service worker - that's in Phase 6
- **Styling**: Use existing shadcn/ui components and Tailwind classes, do not create new design system elements
- **Navigation**: The sidebar items (Dashboard, Exams, Admin, Settings) are placeholders - actual routes will be built in later phases
- **Theme**: Dark mode should be the default, matching the project's design preference
- **Hydration**: Use `suppressHydrationWarning` on html element and handle mounted state in theme toggle to avoid hydration mismatches
